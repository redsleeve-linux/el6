diff --git a/libtiff/tif_unix.c b/libtiff/tif_unix.c
index b73e80d..2171e27 100644
--- a/libtiff/tif_unix.c
+++ b/libtiff/tif_unix.c
@@ -238,6 +238,9 @@ TIFFOpenW(const wchar_t* name, const char* mode)
 void*
 _TIFFmalloc(tsize_t s)
 {
+    if (s == 0)
+        return ((void *) NULL);
+
 	return (malloc((size_t) s));
 }
 
diff --git a/libtiff/tif_win32.c b/libtiff/tif_win32.c
index 2ab944b..3397ad9 100644
--- a/libtiff/tif_win32.c
+++ b/libtiff/tif_win32.c
@@ -280,6 +280,9 @@ TIFFOpenW(const wchar_t* name, const char* mode)
 tdata_t
 _TIFFmalloc(tsize_t s)
 {
+    if ( s == 0 )
+        return ((tdata_t) NULL);
+
 	return ((tdata_t)GlobalAlloc(GMEM_FIXED, s));
 }
 
